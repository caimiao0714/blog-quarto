{
  "hash": "3c7597abd61e4e8c6d5301ee88f87952",
  "result": {
    "markdown": "---\nformat: \n  revealjs:\n    slide-number: true\n    width: 1920\n    height: 1080\n    theme: simple\nlink-citations: yes\nexecute:\n    freeze: auto\n---\n\n\n##  {background-image=\"Figures/CJASN.png\" background-size='contain' background-position=\"right\"}\n\n<br>\n\n<h1> R语言与地图绘制 </h1> \n\n<br>\n\n<h3> 蔡苗</h3> \n\n<br>\n\n<h3>2022年10月</h3> \n\n<br>\n\n## 公共卫生科研中的空间数据\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n**Author**\n\n- A cohort of over 1 million participants\n\n- A prospective cohort of half a million participants\n\n- A nationally representative sample\n:::\n\n::: {.column width=\"50%\"}\n**Reviewer**\n\n- 中国是哪里？\n\n- 广西是哪里？\n\n- 病人在哪里？\n\n- 样本主要在东西南北哪边？\n:::\n\n::::\n\n\n\n\n# 空间数据总述\n\n在公共卫生的科研论文或标书撰写过程中，我们常常需要使用地址数据。此时，能用可视化的方式展示样本的空间分布往往能够给编辑或审稿人较好的印象分。\n\n## 数据类型\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n- **栅格数据（raster data）**：一般是规整的相等面积的长方形格子。\n- 常见数据格式：`.tif`和`.nc`。\n![栅格数据示例（广州市PM$_{2.5}$浓度分布）](Figures/raster-data-example-noborder.png){width=\"80%\"}\n:::\n\n::: {.column width=\"50%\"}\n- 矢量数据（vector data）：点、线、多边形（polygons）。\n- 常见数据格式：`.shp`。\n![矢量数据示例（广州市区县边界）](Figures/vector-data-example.png){width=\"80%\"}\n:::\n\n::::\n\n\n## 相关R包\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n**栅格数据（raster data）**\n\n  -   新：`stars`\n  -   旧：`raster`, `terra`\n\n:::\n\n::: {.column width=\"50%\"}\n**矢量数据**\n\n  -   新：`sf`\n  -   旧：`sp`\n:::\n\n::::\n\n\n\n:::: {.columns}\n\n::: {.column width=\"50%\"}\n<center>\n![`stars`](Figures/stars-hex.png){width=10cm}\n</center>\n:::\n\n::: {.column width=\"50%\"}\n<center>\n![`sf`](Figures/sf-hex.png){width=10cm}\n</center>\n:::\n\n::::\n\n\n\n## 相关函数\n\n### 读取数据\n\n-   矢量数据：`sf::read_sf()`\n-   栅格数据：\n    -   新：`stars::read_stars()`\n    -   旧：`raster::raster()`, `terra`\n    \n### 数据绘图\n\n此处只介绍运用`ggplot2`图层语法进行绘图的函数\n\n-   矢量数据：`geom_sf()`\n-   栅格数据：`geom_stars()`\n\n\n\n# R语言实践\n\n## 加载环境\n\n首先需要加载R环境和相关的包。如果你使用的是课题组的Linux服务器，则下面三行均需要运行。如果你使用自己的电脑，或者你的R包环境已经配置好，可以忽略`pacman::p_load`下面的那两句。\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(raster, sf, stars, cubelyr, dplyr, ggplot2, viridis, here, ggspatial)\n\noptions(rgl.useNULL = TRUE)\nSys.setenv(PROJ_LIB = '/data1/Software/Installed/Anaconda3/envs/r4.1/share/proj')\n```\n:::\n\n\n\n## test\n\n\n::: {.cell output-location='slide'}\n\n```{.r .cell-code}\n1 + 1\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\r\n<script>\r\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\r\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\r\n  // slide changes (different for each slide format).\r\n  (function () {\r\n    function fireSlideChanged(previousSlide, currentSlide) {\r\n\r\n      // dispatch for htmlwidgets\r\n      const event = window.document.createEvent(\"Event\");\r\n      event.initEvent(\"slideenter\", true, true);\r\n      window.document.dispatchEvent(event);\r\n\r\n      // dispatch for shiny\r\n      if (window.jQuery) {\r\n        if (previousSlide) {\r\n          window.jQuery(previousSlide).trigger(\"hidden\");\r\n        }\r\n        if (currentSlide) {\r\n          window.jQuery(currentSlide).trigger(\"shown\");\r\n        }\r\n      }\r\n    }\r\n\r\n    // hookup for reveal\r\n    if (window.Reveal) {\r\n      window.Reveal.addEventListener(\"slidechanged\", function(event) {\r\n        fireSlideChanged(event.previousSlide, event.currentSlide);\r\n      });\r\n    }\r\n\r\n    // hookup for slidy\r\n    if (window.w3c_slidy) {\r\n      window.w3c_slidy.add_observer(function (slide_num) {\r\n        // slide_num starts at position 1\r\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\r\n      });\r\n    }\r\n\r\n  })();\r\n</script>\r\n\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}